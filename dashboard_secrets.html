<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OpenClaw Secrets Manager</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: #f5f5f5;
        color: #333;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        padding: 20px;
      }

      .container {
        max-width: 600px;
        margin: 0 auto;
      }

      header {
        margin-bottom: 30px;
      }

      h1 {
        font-size: 24px;
        margin-bottom: 8px;
      }

      .subtitle {
        color: #666;
        font-size: 14px;
      }

      .section {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .section h2 {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .field-group {
        margin-bottom: 16px;
      }

      .field-wrapper {
        display: flex;
        gap: 8px;
        align-items: flex-end;
      }

      .field-wrapper.full {
        flex-direction: column;
        align-items: stretch;
      }

      label {
        display: block;
        font-size: 13px;
        font-weight: 500;
        margin-bottom: 4px;
        color: #555;
      }

      input[type="text"],
      input[type="password"] {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
        font-family: inherit;
      }

      input[type="text"]:focus,
      input[type="password"]:focus {
        outline: none;
        border-color: #0066cc;
        box-shadow: 0 0 0 2px rgba(0, 102, 204, 0.1);
      }

      .button-group {
        display: flex;
        gap: 8px;
        margin-top: 12px;
      }

      button {
        padding: 8px 14px;
        border: none;
        border-radius: 4px;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s;
      }

      .btn-save {
        background: #0066cc;
        color: white;
      }

      .btn-save:hover {
        background: #0052a3;
      }

      .btn-toggle {
        background: #e8e8e8;
        color: #333;
      }

      .btn-toggle:hover {
        background: #d8d8d8;
      }

      .status {
        display: inline-block;
        font-size: 12px;
        font-weight: 500;
        padding: 4px 8px;
        border-radius: 3px;
        margin-top: 4px;
      }

      .status.set {
        background: #d4edda;
        color: #155724;
      }

      .status.missing {
        background: #f8d7da;
        color: #721c24;
      }

      .toast {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 12px 16px;
        background: #333;
        color: white;
        border-radius: 4px;
        font-size: 13px;
        z-index: 1000;
      }

      .toast.error {
        background: #dc3545;
      }

      .toggle-icon {
        cursor: pointer;
        display: inline-block;
        width: 28px;
        height: 28px;
        background: #e8e8e8;
        border: 1px solid #ccc;
        border-radius: 4px;
        text-align: center;
        line-height: 28px;
        font-size: 12px;
        flex-shrink: 0;
      }

      .toggle-icon:hover {
        background: #d8d8d8;
      }

      @media (max-width: 600px) {
        .container {
          padding: 0;
        }

        .section {
          border-radius: 0;
          margin-bottom: 0;
          border-bottom: 1px solid #ddd;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>üîê Secrets Manager</h1>
        <p class="subtitle">Store and encrypt API credentials for integrations</p>
      </header>

      <!-- Slack -->
      <div class="section">
        <h2>üí¨ Slack</h2>

        <div class="field-group">
          <label>Bot Token (xoxb-...)</label>
          <div class="field-wrapper">
            <input
              type="password"
              id="slack-bot-token"
              placeholder="xoxb-..."
              data-secret="slack_bot_token"
            />
            <span class="toggle-icon" onclick="toggleField('slack-bot-token')">üëÅÔ∏è</span>
          </div>
          <div class="status missing" id="status-slack-bot">‚ö†Ô∏è Not Set</div>
        </div>

        <div class="field-group">
          <label>App Token (xapp-...)</label>
          <div class="field-wrapper">
            <input
              type="password"
              id="slack-app-token"
              placeholder="xapp-..."
              data-secret="slack_app_token"
            />
            <span class="toggle-icon" onclick="toggleField('slack-app-token')">üëÅÔ∏è</span>
          </div>
          <div class="status missing" id="status-slack-app">‚ö†Ô∏è Not Set</div>
        </div>

        <div class="field-group">
          <label>Signing Secret</label>
          <div class="field-wrapper">
            <input
              type="password"
              id="slack-signing-secret"
              placeholder="..."
              data-secret="slack_signing_secret"
            />
            <span class="toggle-icon" onclick="toggleField('slack-signing-secret')">üëÅÔ∏è</span>
          </div>
          <div class="status missing" id="status-slack-signing">‚ö†Ô∏è Not Set</div>
        </div>

        <div class="field-group">
          <label>Report Channel</label>
          <input
            type="text"
            id="slack-channel"
            placeholder="general"
            data-secret="slack_channel"
            style="width: 100%"
          />
          <div class="status missing" id="status-slack-channel">‚ö†Ô∏è Not Set</div>
        </div>

        <div class="button-group">
          <button class="btn-save" onclick="saveSlack()">üíæ Save</button>
        </div>
      </div>

      <!-- Telegram -->
      <div class="section">
        <h2>üì± Telegram</h2>

        <div class="field-group">
          <label>Bot Token</label>
          <div class="field-wrapper">
            <input
              type="password"
              id="telegram-bot-token"
              placeholder="123456789:ABC..."
              data-secret="telegram_bot_token"
              style="flex: 1"
            />
            <span class="toggle-icon" onclick="toggleField('telegram-bot-token')">üëÅÔ∏è</span>
          </div>
          <div class="status missing" id="status-telegram-bot">‚ö†Ô∏è Not Set</div>
        </div>

        <div class="button-group">
          <button class="btn-save" onclick="saveTelegram()">üíæ Save</button>
        </div>
      </div>

      <!-- Discord -->
      <div class="section">
        <h2>üéÆ Discord</h2>

        <div class="field-group">
          <label>Bot Token</label>
          <div class="field-wrapper">
            <input
              type="password"
              id="discord-bot-token"
              placeholder="MTk4Nz..."
              data-secret="discord_bot_token"
              style="flex: 1"
            />
            <span class="toggle-icon" onclick="toggleField('discord-bot-token')">üëÅÔ∏è</span>
          </div>
          <div class="status missing" id="status-discord-bot">‚ö†Ô∏è Not Set</div>
        </div>

        <div class="button-group">
          <button class="btn-save" onclick="saveDiscord()">üíæ Save</button>
        </div>
      </div>

      <!-- Anthropic -->
      <div class="section">
        <h2>ü§ñ Anthropic API</h2>

        <div class="field-group">
          <label>API Key</label>
          <div class="field-wrapper">
            <input
              type="password"
              id="anthropic-api-key"
              placeholder="sk-ant-..."
              data-secret="anthropic_api_key"
              style="flex: 1"
            />
            <span class="toggle-icon" onclick="toggleField('anthropic-api-key')">üëÅÔ∏è</span>
          </div>
          <div class="status missing" id="status-anthropic-api">‚ö†Ô∏è Not Set</div>
        </div>

        <div class="button-group">
          <button class="btn-save" onclick="saveAnthropic()">üíæ Save</button>
        </div>
      </div>
    </div>

    <script>
      const ENCRYPTION_KEY = "openclaw-secrets-2026";

      // Simple Base64 encryption (not cryptographically secure, but lightweight)
      function encrypt(text) {
        return btoa(text);
      }

      function decrypt(encoded) {
        try {
          return atob(encoded);
        } catch {
          return "";
        }
      }

      function loadSecrets() {
        const stored = localStorage.getItem("openclaw_secrets");
        if (stored) {
          try {
            const decrypted = decrypt(stored);
            const secrets = JSON.parse(decrypted);

            // Load each field
            Object.entries(secrets).forEach(([key, value]) => {
              const input = document.querySelector(`[data-secret="${key}"]`);
              if (input) {
                input.value = value;
                updateStatus(key, true);
              }
            });
          } catch (e) {
            console.error("Failed to load secrets:", e);
          }
        }
      }

      function updateStatus(secretKey, isSet) {
        const statusId = `status-${secretKey.replace(/_/g, "-")}`;
        const status = document.getElementById(statusId);
        if (status) {
          if (isSet) {
            status.classList.remove("missing");
            status.classList.add("set");
            status.textContent = "‚úÖ Configured";
          } else {
            status.classList.remove("set");
            status.classList.add("missing");
            status.textContent = "‚ö†Ô∏è Not Set";
          }
        }
      }

      function saveSecrets(data) {
        try {
          const stored = localStorage.getItem("openclaw_secrets");
          let secrets = {};

          if (stored) {
            try {
              const decrypted = decrypt(stored);
              secrets = JSON.parse(decrypted);
            } catch {}
          }

          secrets = { ...secrets, ...data };
          const encrypted = encrypt(JSON.stringify(secrets));
          localStorage.setItem("openclaw_secrets", encrypted);

          showToast("‚úÖ Secrets saved");
          loadSecrets();
        } catch (e) {
          console.error("Failed to save:", e);
          showToast("‚ùå Failed to save secrets", "error");
        }
      }

      function saveSlack() {
        const data = {
          slack_bot_token: document.getElementById("slack-bot-token").value.trim(),
          slack_app_token: document.getElementById("slack-app-token").value.trim(),
          slack_signing_secret: document.getElementById("slack-signing-secret").value.trim(),
          slack_channel: document.getElementById("slack-channel").value.trim(),
        };

        if (
          !data.slack_bot_token ||
          !data.slack_app_token ||
          !data.slack_signing_secret ||
          !data.slack_channel
        ) {
          showToast("‚ùå Fill all Slack fields", "error");
          return;
        }

        saveSecrets(data);
        // Update status badges immediately
        updateStatus("slack_bot_token", true);
        updateStatus("slack_app_token", true);
        updateStatus("slack_signing_secret", true);
        updateStatus("slack_channel", true);
      }

      function saveTelegram() {
        const data = {
          telegram_bot_token: document.getElementById("telegram-bot-token").value.trim(),
        };

        if (!data.telegram_bot_token) {
          showToast("‚ùå Enter Telegram bot token", "error");
          return;
        }

        saveSecrets(data);
        updateStatus("telegram_bot_token", true);
      }

      function saveDiscord() {
        const data = {
          discord_bot_token: document.getElementById("discord-bot-token").value.trim(),
        };

        if (!data.discord_bot_token) {
          showToast("‚ùå Enter Discord bot token", "error");
          return;
        }

        saveSecrets(data);
        updateStatus("discord_bot_token", true);
      }

      function saveAnthropic() {
        const data = {
          anthropic_api_key: document.getElementById("anthropic-api-key").value.trim(),
        };

        if (!data.anthropic_api_key) {
          showToast("‚ùå Enter Anthropic API key", "error");
          return;
        }

        saveSecrets(data);
        updateStatus("anthropic_api_key", true);
      }

      function toggleField(fieldId) {
        const input = document.getElementById(fieldId);
        input.type = input.type === "password" ? "text" : "password";
      }

      function showToast(message, type = "success") {
        const toast = document.createElement("div");
        toast.className = `toast ${type === "error" ? "error" : ""}`;
        toast.textContent = message;
        document.body.appendChild(toast);

        setTimeout(() => {
          toast.remove();
        }, 3000);
      }

      // Load secrets on page load
      document.addEventListener("DOMContentLoaded", loadSecrets);
    </script>
  </body>
</html>
