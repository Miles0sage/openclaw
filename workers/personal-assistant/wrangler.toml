name = "personal-assistant"
main = "src/index.ts"
compatibility_date = "2026-02-19"
compatibility_flags = ["nodejs_compat"]
workers_dev = true

# Environment variables (override via wrangler secret for production)
[vars]
GATEWAY_URL = "https://gateway.overseerclaw.uk"
GATEWAY_TOKEN = "f981afbc4a94f50a87cd0184cf560ec646e8f8a65a7234f603b980e43775f1a3"
ENVIRONMENT = "development"
RATE_LIMIT_PER_MINUTE = "30"
GEMINI_MODEL = "gemini-2.5-flash"

# D1 Database binding (session storage)
[[d1_databases]]
binding = "DB"
database_name = "personal-assistant"
database_id = "9cf10366-f49c-4532-89c2-8859e1ed9673"

# KV bindings (cache + sessions)
[[kv_namespaces]]
binding = "KV_CACHE"
id = "35795036d1084b8284a8c57f4b170618"

[[kv_namespaces]]
binding = "KV_SESSIONS"
id = "a4119f70fe7d42ecb8b8b49569c11e32"

[env.production]
name = "personal-assistant"
routes = [{ pattern = "assistant.overseerclaw.uk/*", zone_name = "overseerclaw.uk" }]

[env.production.vars]
ENVIRONMENT = "production"
GATEWAY_URL = "https://gateway.overseerclaw.uk"
GATEWAY_TOKEN = "f981afbc4a94f50a87cd0184cf560ec646e8f8a65a7234f603b980e43775f1a3"
RATE_LIMIT_PER_MINUTE = "30"
GEMINI_MODEL = "gemini-2.5-flash"

[[env.production.kv_namespaces]]
binding = "KV_CACHE"
id = "35795036d1084b8284a8c57f4b170618"

[[env.production.kv_namespaces]]
binding = "KV_SESSIONS"
id = "a4119f70fe7d42ecb8b8b49569c11e32"

[[env.production.d1_databases]]
binding = "DB"
database_name = "personal-assistant"
database_id = "9cf10366-f49c-4532-89c2-8859e1ed9673"

[env.development]
name = "personal-assistant-dev"
vars = { ENVIRONMENT = "development" }

# Cron triggers â€” check reminders + morning briefing
# 14:00 UTC = 7am MST (morning briefing before Miles' day starts)
# 00:00 UTC = 5pm MST (start of Miles' work shift)
# Every 15 min for time-based reminder checks
[triggers]
crons = ["0 14 * * *", "0 0 * * *", "*/15 * * * *"]

[env.production.triggers]
crons = ["0 14 * * *", "0 0 * * *", "*/15 * * * *"]

[limits]
cpu_ms = 50000
